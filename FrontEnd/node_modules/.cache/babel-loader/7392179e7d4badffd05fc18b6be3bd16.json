{"ast":null,"code":"import { sum, map, filter, uniqBy } from \"lodash\";\nimport { createSlice } from \"@reduxjs/toolkit\"; // utils\n\nimport axios from \"../../utils/axios\"; // ----------------------------------------------------------------------\n\nconst initialState = {\n  isLoading: false,\n  error: false,\n  products: [],\n  product: {},\n  sortBy: null,\n  filters: {\n    gender: [],\n    category: \"All\",\n    colors: [],\n    priceRange: \"\",\n    rating: \"\"\n  },\n  checkout: {\n    activeStep: 0,\n    cart: [],\n    subtotal: 0,\n    total: 0,\n    discount: 0,\n    shipping: 0,\n    billing: null,\n    active: false,\n    complete: false\n  }\n};\nconst slice = createSlice({\n  name: \"product\",\n  initialState,\n  reducers: {\n    changeActive(state, action) {\n      state.checkout.active = action.payload;\n    },\n\n    // START LOADING\n    startLoading(state) {\n      state.isLoading = true;\n    },\n\n    // HAS ERROR\n    hasError(state, action) {\n      state.isLoading = false;\n      state.error = action.payload;\n    },\n\n    // GET PRODUCTS\n    getProductsSuccess(state, action) {\n      state.isLoading = false;\n      state.products = action.payload;\n    },\n\n    getCheckoutSuccess(state, action) {\n      state.isLoading = false;\n      state.checkout.complete = action.payload;\n    },\n\n    // GET PRODUCT\n    getProductSuccess(state, action) {\n      state.isLoading = false;\n      state.product = action.payload;\n    },\n\n    //  SORT & FILTER PRODUCTS\n    sortByProducts(state, action) {\n      state.sortBy = action.payload;\n    },\n\n    filterProducts(state, action) {\n      state.filters.gender = action.payload.gender;\n      state.filters.category = action.payload.category;\n      state.filters.colors = action.payload.colors;\n      state.filters.priceRange = action.payload.priceRange;\n      state.filters.rating = action.payload.rating;\n    },\n\n    // CHECKOUT\n    getCart(state, action) {\n      const cart = action.payload;\n      console.log(cart);\n      const subtotal = sum(cart.map(_product => _product.quantity ? _product.quantity * _product.precio : _product.precio));\n      const discount = cart.length === 0 ? 0 : state.checkout.discount;\n      const shipping = cart.length === 0 ? 0 : state.checkout.shipping;\n      const billing = cart.length === 0 ? null : state.checkout.billing;\n      state.checkout.cart = cart;\n      state.checkout.discount = discount;\n      state.checkout.shipping = shipping;\n      state.checkout.billing = billing;\n      state.checkout.subtotal = subtotal;\n      state.checkout.total = subtotal - discount;\n    },\n\n    addCart(state, action) {\n      const product = action.payload;\n      const isEmptyCart = state.checkout.cart.length === 0;\n      let newProduct = {};\n\n      if (isEmptyCart) {\n        newProduct = { ...product,\n          quantity: 1,\n          total: product.precio\n        };\n        state.checkout.cart = [...state.checkout.cart, newProduct];\n      } else {\n        state.checkout.cart = map(state.checkout.cart, _product => {\n          const isExisted = _product.id === product.id;\n\n          if (isExisted) {\n            return { ..._product,\n              quantity: _product.stock > _product.quantity ? _product.quantity + 1 : _product.quantity,\n              total: _product.quantity * _product.precio\n            };\n          }\n\n          return { ..._product,\n            quantity: _product.quantity,\n            total: _product.precio\n          };\n        });\n      }\n\n      state.checkout.cart = uniqBy([...state.checkout.cart, { ...product,\n        quantity: 1,\n        total: product.precio\n      }], \"id\");\n    },\n\n    deleteCart(state, action) {\n      const updateCart = filter(state.checkout.cart, item => item.id !== action.payload);\n      state.checkout.cart = updateCart;\n    },\n\n    resetCart(state) {\n      state.checkout.activeStep = 0;\n      state.checkout.cart = [];\n      state.checkout.total = 0;\n      state.checkout.subtotal = 0;\n      state.checkout.discount = 0;\n      state.checkout.shipping = 0;\n      state.checkout.billing = null;\n      state.checkout.active = false;\n    },\n\n    onBackStep(state) {\n      state.checkout.activeStep -= 1;\n    },\n\n    onNextStep(state) {\n      state.checkout.activeStep += 1;\n    },\n\n    onGotoStep(state, action) {\n      const goToStep = action.payload;\n      state.checkout.activeStep = goToStep;\n    },\n\n    increaseQuantity(state, action) {\n      const productId = action.payload;\n      const updateCart = map(state.checkout.cart, product => {\n        if (product.id === productId) {\n          if (product.stock > product.quantity) {\n            return { ...product,\n              quantity: product.quantity ? product.quantity + 1 : 2,\n              total: product.total + product.precio\n            };\n          }\n        }\n\n        return product;\n      });\n      state.checkout.cart = updateCart;\n    },\n\n    decreaseQuantity(state, action) {\n      const productId = action.payload;\n      const updateCart = map(state.checkout.cart, product => {\n        if (product.id === productId) {\n          if (product.quantity > 1) {\n            return { ...product,\n              quantity: product.quantity - 1,\n              total: product.total - product.precio\n            };\n          }\n        }\n\n        return product;\n      });\n      state.checkout.cart = updateCart;\n    },\n\n    createBilling(state, action) {\n      state.checkout.billing = action.payload;\n    },\n\n    applyDiscount(state, action) {\n      const discount = action.payload;\n      state.checkout.discount = discount;\n      state.checkout.total = state.checkout.subtotal - discount;\n    },\n\n    applyShipping(state, action) {\n      const shipping = action.payload;\n      state.checkout.shipping = shipping;\n      state.checkout.total = state.checkout.subtotal - state.checkout.discount + shipping;\n    }\n\n  }\n}); // Reducer\n\nexport default slice.reducer; // Actions\n\nexport const {\n  getCart,\n  addCart,\n  resetCart,\n  onGotoStep,\n  onBackStep,\n  onNextStep,\n  deleteCart,\n  createBilling,\n  applyShipping,\n  applyDiscount,\n  increaseQuantity,\n  decreaseQuantity,\n  sortByProducts,\n  filterProducts,\n  changeActive\n} = slice.actions; // ----------------------------------------------------------------------\n\nexport function getProducts() {\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n\n    try {\n      const response = await axios.get(\"/product\");\n      dispatch(slice.actions.getProductsSuccess(response.data.data));\n    } catch (error) {\n      alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\n      dispatch(slice.actions.hasError(error));\n    }\n  };\n} // ----------------------------------------------------------------------\n\nexport function getProduct(id) {\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n\n    try {\n      const response = await axios.get(\"/product/\" + id);\n      console.log(response);\n      dispatch(slice.actions.getProductSuccess(response.data.data));\n    } catch (error) {\n      console.error(error);\n      alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\n      window.location = \"/\";\n      dispatch(slice.actions.hasError(error));\n    }\n  };\n}\nexport function CheckoutDone(arr) {\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n\n    try {\n      const response = await axios.post(\"/product/checkout/\", {\n        data: arr\n      });\n\n      if (response.status === 200) {\n        dispatch(slice.actions.getCheckoutSuccess(response.data.data));\n        dispatch(slice.actions.resetCart());\n        alert(\"Pago realizado con exito\");\n        window.location = \"/\";\n      }\n    } catch (error) {\n      console.error(error);\n      alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\n      window.location = \"/\";\n      dispatch(slice.actions.hasError(error));\n    }\n  };\n}\n_c = CheckoutDone;\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutDone\");","map":{"version":3,"sources":["D:/projects/SneakerCity/FronEnd/src/redux/slices/product.js"],"names":["sum","map","filter","uniqBy","createSlice","axios","initialState","isLoading","error","products","product","sortBy","filters","gender","category","colors","priceRange","rating","checkout","activeStep","cart","subtotal","total","discount","shipping","billing","active","complete","slice","name","reducers","changeActive","state","action","payload","startLoading","hasError","getProductsSuccess","getCheckoutSuccess","getProductSuccess","sortByProducts","filterProducts","getCart","console","log","_product","quantity","precio","length","addCart","isEmptyCart","newProduct","isExisted","id","stock","deleteCart","updateCart","item","resetCart","onBackStep","onNextStep","onGotoStep","goToStep","increaseQuantity","productId","decreaseQuantity","createBilling","applyDiscount","applyShipping","reducer","actions","getProducts","dispatch","response","get","data","alert","getProduct","window","location","CheckoutDone","arr","post","status"],"mappings":"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","sourcesContent":["import { sum, map, filter, uniqBy } from \"lodash\";\r\nimport { createSlice } from \"@reduxjs/toolkit\";\r\n// utils\r\n\r\nimport axios from \"../../utils/axios\";\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  error: false,\r\n  products: [],\r\n  product: {},\r\n  sortBy: null,\r\n  filters: {\r\n    gender: [],\r\n    category: \"All\",\r\n    colors: [],\r\n    priceRange: \"\",\r\n    rating: \"\",\r\n  },\r\n  checkout: {\r\n    activeStep: 0,\r\n    cart: [],\r\n    subtotal: 0,\r\n    total: 0,\r\n    discount: 0,\r\n    shipping: 0,\r\n    billing: null,\r\n    active: false,\r\n    complete: false,\r\n  },\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"product\",\r\n  initialState,\r\n  reducers: {\r\n    changeActive(state, action) {\r\n      state.checkout.active = action.payload;\r\n    },\r\n    // START LOADING\r\n    startLoading(state) {\r\n      state.isLoading = true;\r\n    },\r\n\r\n    // HAS ERROR\r\n    hasError(state, action) {\r\n      state.isLoading = false;\r\n      state.error = action.payload;\r\n    },\r\n\r\n    // GET PRODUCTS\r\n    getProductsSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.products = action.payload;\r\n    },\r\n\r\n    getCheckoutSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.checkout.complete = action.payload;\r\n    },\r\n    // GET PRODUCT\r\n    getProductSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.product = action.payload;\r\n    },\r\n\r\n    //  SORT & FILTER PRODUCTS\r\n    sortByProducts(state, action) {\r\n      state.sortBy = action.payload;\r\n    },\r\n\r\n    filterProducts(state, action) {\r\n      state.filters.gender = action.payload.gender;\r\n      state.filters.category = action.payload.category;\r\n      state.filters.colors = action.payload.colors;\r\n      state.filters.priceRange = action.payload.priceRange;\r\n      state.filters.rating = action.payload.rating;\r\n    },\r\n\r\n    // CHECKOUT\r\n    getCart(state, action) {\r\n      const cart = action.payload;\r\n      console.log(cart);\r\n\r\n      const subtotal = sum(\r\n        cart.map((_product) =>\r\n          _product.quantity\r\n            ? _product.quantity * _product.precio\r\n            : _product.precio\r\n        )\r\n      );\r\n\r\n      const discount = cart.length === 0 ? 0 : state.checkout.discount;\r\n      const shipping = cart.length === 0 ? 0 : state.checkout.shipping;\r\n      const billing = cart.length === 0 ? null : state.checkout.billing;\r\n\r\n      state.checkout.cart = cart;\r\n      state.checkout.discount = discount;\r\n      state.checkout.shipping = shipping;\r\n      state.checkout.billing = billing;\r\n      state.checkout.subtotal = subtotal;\r\n      state.checkout.total = subtotal - discount;\r\n    },\r\n\r\n    addCart(state, action) {\r\n      const product = action.payload;\r\n      const isEmptyCart = state.checkout.cart.length === 0;\r\n      let newProduct = {};\r\n\r\n      if (isEmptyCart) {\r\n        newProduct = { ...product, quantity: 1, total: product.precio };\r\n        state.checkout.cart = [...state.checkout.cart, newProduct];\r\n      } else {\r\n        state.checkout.cart = map(state.checkout.cart, (_product) => {\r\n          const isExisted = _product.id === product.id;\r\n          if (isExisted) {\r\n            return {\r\n              ..._product,\r\n              quantity:\r\n                _product.stock > _product.quantity\r\n                  ? _product.quantity + 1\r\n                  : _product.quantity,\r\n              total: _product.quantity * _product.precio,\r\n            };\r\n          }\r\n          return {\r\n            ..._product,\r\n            quantity: _product.quantity,\r\n            total: _product.precio,\r\n          };\r\n        });\r\n      }\r\n\r\n      state.checkout.cart = uniqBy(\r\n        [\r\n          ...state.checkout.cart,\r\n          { ...product, quantity: 1, total: product.precio },\r\n        ],\r\n        \"id\"\r\n      );\r\n    },\r\n\r\n    deleteCart(state, action) {\r\n      const updateCart = filter(\r\n        state.checkout.cart,\r\n        (item) => item.id !== action.payload\r\n      );\r\n      state.checkout.cart = updateCart;\r\n    },\r\n\r\n    resetCart(state) {\r\n      state.checkout.activeStep = 0;\r\n      state.checkout.cart = [];\r\n      state.checkout.total = 0;\r\n      state.checkout.subtotal = 0;\r\n      state.checkout.discount = 0;\r\n      state.checkout.shipping = 0;\r\n      state.checkout.billing = null;\r\n      state.checkout.active = false;\r\n    },\r\n\r\n    onBackStep(state) {\r\n      state.checkout.activeStep -= 1;\r\n    },\r\n\r\n    onNextStep(state) {\r\n      state.checkout.activeStep += 1;\r\n    },\r\n\r\n    onGotoStep(state, action) {\r\n      const goToStep = action.payload;\r\n      state.checkout.activeStep = goToStep;\r\n    },\r\n\r\n    increaseQuantity(state, action) {\r\n      const productId = action.payload;\r\n      const updateCart = map(state.checkout.cart, (product) => {\r\n        if (product.id === productId) {\r\n          if (product.stock > product.quantity) {\r\n            return {\r\n              ...product,\r\n              quantity: product.quantity ? product.quantity + 1 : 2,\r\n              total: product.total + product.precio,\r\n            };\r\n          }\r\n        }\r\n        return product;\r\n      });\r\n      state.checkout.cart = updateCart;\r\n    },\r\n\r\n    decreaseQuantity(state, action) {\r\n      const productId = action.payload;\r\n      const updateCart = map(state.checkout.cart, (product) => {\r\n        if (product.id === productId) {\r\n          if (product.quantity > 1) {\r\n            return {\r\n              ...product,\r\n              quantity: product.quantity - 1,\r\n              total: product.total - product.precio,\r\n            };\r\n          }\r\n        }\r\n        return product;\r\n      });\r\n\r\n      state.checkout.cart = updateCart;\r\n    },\r\n\r\n    createBilling(state, action) {\r\n      state.checkout.billing = action.payload;\r\n    },\r\n\r\n    applyDiscount(state, action) {\r\n      const discount = action.payload;\r\n      state.checkout.discount = discount;\r\n      state.checkout.total = state.checkout.subtotal - discount;\r\n    },\r\n\r\n    applyShipping(state, action) {\r\n      const shipping = action.payload;\r\n      state.checkout.shipping = shipping;\r\n      state.checkout.total =\r\n        state.checkout.subtotal - state.checkout.discount + shipping;\r\n    },\r\n  },\r\n});\r\n\r\n// Reducer\r\nexport default slice.reducer;\r\n\r\n// Actions\r\nexport const {\r\n  getCart,\r\n  addCart,\r\n  resetCart,\r\n  onGotoStep,\r\n  onBackStep,\r\n  onNextStep,\r\n  deleteCart,\r\n  createBilling,\r\n  applyShipping,\r\n  applyDiscount,\r\n  increaseQuantity,\r\n  decreaseQuantity,\r\n  sortByProducts,\r\n  filterProducts,\r\n  changeActive,\r\n} = slice.actions;\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nexport function getProducts() {\r\n  return async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const response = await axios.get(\"/product\");\r\n      dispatch(slice.actions.getProductsSuccess(response.data.data));\r\n    } catch (error) {\r\n      alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\r\n      dispatch(slice.actions.hasError(error));\r\n    }\r\n  };\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nexport function getProduct(id) {\r\n  return async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const response = await axios.get(\"/product/\" + id);\r\n      console.log(response);\r\n      dispatch(slice.actions.getProductSuccess(response.data.data));\r\n    } catch (error) {\r\n      console.error(error);\r\n      alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\r\n      window.location = \"/\";\r\n      dispatch(slice.actions.hasError(error));\r\n    }\r\n  };\r\n}\r\n\r\nexport function CheckoutDone(arr) {\r\n \r\n    return async (dispatch) => {\r\n      dispatch(slice.actions.startLoading());\r\n      try {\r\n        const response = await axios.post(\"/product/checkout/\", { data: arr });\r\n        if (response.status === 200) {\r\n          dispatch(slice.actions.getCheckoutSuccess(response.data.data));\r\n          dispatch(slice.actions.resetCart());\r\n          alert(\"Pago realizado con exito\");\r\n          window.location = \"/\";\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        alert(\"Ocurrio un error con el servidor. Intente recargar la página\");\r\n        window.location = \"/\";\r\n        dispatch(slice.actions.hasError(error));\r\n      }\r\n    };\r\n  \r\n}\r\n"]},"metadata":{},"sourceType":"module"}